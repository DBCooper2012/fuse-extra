<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!--

    Copyright (C) 2010-2012, FuseSource Corp.  All rights reserved.

        http://fusesource.com

    The software in this package is published under the terms of the
    CDDL license a copy of which has been included with this distribution
    in the license.txt file.

-->

<broker xmlns="http://activemq.apache.org/schema/activemq/apollo">

  <authentication domain="MqttSecurityTest"/>
  <access_rule allow="connect_group" action="connect"/>
  <access_rule allow="can_send_create_queue" kind="queue" action="send create"/>
  <access_rule allow="can_send_queue"        kind="queue" action="send"/>
  <access_rule allow="can_receive_queue"     kind="queue" action="receive"/>
  <access_rule allow="can_consume_queue"     kind="queue" action="consume"/>
  <access_rule allow="can_send_create_topic" kind="topic" action="send create"/>
  <access_rule allow="can_send_topic"        kind="topic" action="send"/>
  <access_rule allow="can_recieve_topic"     kind="topic" action="receive"/>
  <access_rule allow="can_consume_create_ds" kind="dsub"  action="consume create"/>
  <access_rule allow="can_consume_ds"        kind="dsub"  action="consume"/>
  <access_rule allow="can_recieve_topic"     kind="dsub"  action="receive"/>

  <access_rule allow="guest" action="connect"/>
  <access_rule allow="guest" action="create destroy send receive consume" kind="topic queue dsub" id_regex="test.*"/>

  <virtual_host id="default" purge_on_startup="true">
    <host_name>localhost</host_name>
  </virtual_host>

  <connector id="tcp" protocol="mqtt" bind="tcp://0.0.0.0:0">
    <mqtt add_user_header="JMSXUserID"/>
  </connector>

</broker>